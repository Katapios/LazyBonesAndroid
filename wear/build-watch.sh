#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–±–æ—Ä–∫–∏ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Wear OS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

echo "üîß –°–±–æ—Ä–∫–∞ Wear OS –º–æ–¥—É–ª—è..."

# –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å–±–æ—Ä–∫–∏
./gradlew :wear:clean

# –°–±–æ—Ä–∫–∞ APK
./gradlew :wear:assembleDebug

if [ $? -eq 0 ]; then
    echo "‚úÖ –°–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞!"
    echo "üì¶ APK: wear/build/outputs/apk/debug/wear-debug.apk"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
    echo ""
    echo "üì± –ü–æ–∏—Å–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤..."
    adb devices
    
    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    read -p "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ? (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        echo "üì≤ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
        ./gradlew :wear:installDebug
        if [ $? -eq 0 ]; then
            echo "‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—Å–ø–µ—à–Ω–∞!"
            echo "üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
            adb shell am start -n com.katapandroid.lazybones.wear/.MainActivity
        fi
    fi
else
    echo "‚ùå –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏!"
    exit 1
fi

